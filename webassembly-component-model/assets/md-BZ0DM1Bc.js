import{_ as u}from"./slidev/VSwitch-CuOn-I8G.js";import{_ as d}from"./slidev/Arrow.vue_vue_type_script_setup_true_lang-Bz1MBIn7.js";import{b as m,o as x,w as s,g as l,e as n,ad as e,v as c,x as y,T as p}from"./modules/vue-CHUb5G5n.js";import{I as h}from"./slidev/default-B3U6jBqI.js";import{u as w,f as b}from"./slidev/context-Dj79Ztak.js";import"./modules/shiki-CWK1cl67.js";import"./index-BhswhIe3.js";const f="/talks/webassembly-component-model/assets/schema-web-Duk5snzu.png",z={__name:"slides.md__slidev_13",setup(g){const{$clicksContext:o,$frontmatter:a}=w();return o.setup(),(v,t)=>{const i=d,r=u;return x(),m(h,c(y(p(b)(p(a),12))),{default:s(()=>[t[22]||(t[22]=l("h1",null,"🏠 Host Runtime : Web 🌐",-1)),t[23]||(t[23]=l("img",{src:f,width:"90%"},null,-1)),n(r,null,{1:s(()=>[...t[0]||(t[0]=[l("div",{class:"host-runtime-description computer",style:{width:"330px"}},[l("p",null,"La version web est lancée dans un navigateur.")],-1),l("div",{class:"rect",style:{left:"80px",width:"540px",height:"44px",top:"138px"},"data-label":"browser"},null,-1)])]),2:s(()=>[...t[1]||(t[1]=[l("div",{class:"host-runtime-description typescript",style:{width:"330px"}},[l("p",null,"Le Web Host est une application TypeScript compilée vers JavaScript."),l("p",null,[l("code",null,"*.html"),e(" + "),l("code",null,"*.css"),e(" + "),l("code",null,"*.js")])],-1),l("div",{class:"rect",style:{left:"93px",width:"302px",height:"43px",top:"182px"},"data-label":"host-web"},null,-1)])]),3:s(()=>[...t[2]||(t[2]=[l("div",{class:"host-runtime-description wasm",style:{width:"330px"}},[l("p",null,[e("Les "),l("strong",null,"composants WebAssembly"),e(" issus de la compilation du code source des plugins en Rust, C, Go.")]),l("p",null,[e("Sont transpilés avec "),l("code",null,"jco transpile"),e(" en :")]),l("ul",null,[l("li",null,[l("strong",null,"WebAssembly Modules"),e(" (WASM)")]),l("li",null,[l("strong",null,"Glue code"),e(" (JS)")])]),l("p",null,"Le navigateur ne supporte pas nativement les composants WebAssembly.")],-1),l("div",{class:"rect",style:{left:"125px",width:"275px",height:"254px",top:"262px","border-radius":"35px"},"data-label":"wasm-files"},null,-1)])]),4:s(()=>[...t[3]||(t[3]=[l("div",{class:"host-runtime-description wasm",style:{"font-size":"70%",width:"290px"}},[l("p",null,[l("code",null,"repl-logic-guest.wasm")]),l("p",null,[l("strong",null,"IDENTIQUE"),e(" à la version CLI")]),l("p",null,[l("strong",null,"Rôle:"),e(" Orchestrer l'entrée utilisateur et le dispatch de plugins")]),l("p",null,[l("strong",null,"Responsabilités:")]),l("ul",null,[l("li",null,[e("Variable expansion ("),l("code",null,"export VAR=value"),e(")")]),l("li",null,[e("Commandes réservées ("),l("code",null,"help"),e(", "),l("code",null,"man"),e(", "),l("code",null,"export"),e(")")]),l("li",null,"Dispatch de plugins")]),l("p",null,"Réutilisation du code entre CLI et navigateur (cohérence du minishell entre les plateformes).")],-1),l("div",{class:"rect",style:{left:"140px",width:"250px",height:"40px",top:"280px"},"data-label":"repl-logic"},null,-1)])]),5:s(()=>[...t[4]||(t[4]=[l("div",{class:"host-runtime-description wasm",style:{"font-size":"70%",width:"290px"}},[l("p",null,[l("code",null,"plugin*.wasm"),e(" - "),l("strong",null,"IDENTIQUE"),e(" à la version CLI")]),l("p",null,[e("Chaque commande ("),l("code",null,"echo"),e(", "),l("code",null,"ls"),e(", "),l("code",null,"cat"),e(", "),l("code",null,"tee"),e(" ...) est un plugin.")]),l("p",null,"Chaque plugin est un composant WebAssembly."),l("p",null,"Compilé depuis Rust, C, Go, TypeScript."),l("p",null,"Tous les plugins respectent la même interface WIT.")],-1),l("div",{class:"rect",style:{left:"142px",width:"152px",height:"157px",top:"323px"},"data-label":"plugins"},null,-1)])]),6:s(()=>[...t[5]||(t[5]=[l("div",{class:"host-runtime-description typescript",style:{"font-size":"80%"}},[l("p",null,"Les navigateurs n'ont pas accès au filesystem."),l("p",null,"→ Filesystem virtuel en mémoire.")],-1),l("div",{class:"rect",style:{left:"431px",width:"148px",height:"99px",top:"413px"},"data-label":"filesystem-virtual"},null,-1)])]),7:s(()=>[...t[6]||(t[6]=[l("div",{class:"host-runtime-description typescript",style:{"font-size":"80%"}},[l("p",null,[l("a",{href:"https://github.com/topheman/webassembly-component-model-experiments/blob/master/packages/web-host/src/wasm/virtualFs.ts",target:"_blank"},"virtualFs.ts")]),l("p",null,[e("Fichier généré exposant la fonction "),l("code",null,"makeVirtualFs()"),e(".")]),l("p",null,[e("Qui sera fourni au shim de "),l("code",null,"wasi:filesystem"),e(".")])],-1),l("div",{class:"rect",style:{left:"431px",width:"148px",height:"99px",top:"413px"},"data-label":"filesystem-virtual"},null,-1)])]),8:s(()=>[t[7]||(t[7]=l("div",{class:"host-runtime-description typescript",style:{"font-size":"80%"}},[l("p",null,[l("a",{href:"https://github.com/topheman/webassembly-component-model-experiments/blob/master/packages/web-host/overrides/%40bytecodealliance/preview2-shim/lib/browser/filesystem.js",target:"_blank"},"@bytecodealliance/preview2-shim/filesystem")]),l("p",null,"Shim WASI preview2 Filesystem."),l("p",null,[l("code",null,"_setFileData(makeVirtualFs())")])],-1)),t[8]||(t[8]=l("div",{class:"rect",style:{left:"468px",width:"74px",height:"33px",top:"332px"},"data-label":"shim"},null,-1)),n(i,{x1:"506",y1:"362",x2:"506",y2:"422",color:"#900000",width:"4","data-label":"arrow-fs-2"}),t[9]||(t[9]=l("div",{class:"rect",style:{left:"431px",width:"148px",height:"99px",top:"413px"},"data-label":"filesystem-virtual"},null,-1))]),9:s(()=>[t[10]||(t[10]=l("div",{class:"host-runtime-description wasm",style:{"font-size":"75%"}},[l("p",null,[l("code",null,"plugin*.wasm"),e(" 📁")]),l("p",null,[e("Les calls natifs "),l("code",null,"std::fs::*"),e(" dans les plugins sont interceptés par le shim de "),l("code",null,"wasi:filesystem"),e(".")]),l("p",null,[l("code",null,"std::fs::{read_dir, File, read_to_string}"),e(" marchent de façon transparente.")]),l("p",null,[l("strong",null,"#WASI")])],-1)),t[11]||(t[11]=l("div",{class:"rect",style:{left:"142px",width:"152px",height:"157px",top:"323px"},"data-label":"plugins"},null,-1)),t[12]||(t[12]=l("div",{class:"rect",style:{left:"468px",width:"74px",height:"33px",top:"332px"},"data-label":"shim"},null,-1)),n(i,{x1:"318",y1:"350",x2:"460",y2:"350",color:"#900000",width:"4","data-label":"arrow-fs-1"}),n(i,{x1:"506",y1:"362",x2:"506",y2:"422",color:"#900000",width:"4","data-label":"arrow-fs-2"}),t[13]||(t[13]=l("div",{class:"rect",style:{left:"431px",width:"148px",height:"99px",top:"413px"},"data-label":"filesystem-virtual"},null,-1))]),10:s(()=>[t[14]||(t[14]=l("div",{class:"host-runtime-description wasm",style:{"font-size":"75%"}},[l("p",null,[l("code",null,"plugin*.wasm"),e(" 📁")]),l("p",null,[l("a",{href:"https://github.com/topheman/webassembly-component-model-experiments/pull/15",target:"_blank"},"Support WRITE operations"),e(" pour plugin "),l("code",null,"tee")]),l("p",null,[l("strong",null,"#WASI")])],-1)),t[15]||(t[15]=l("div",{class:"rect",style:{left:"142px",width:"152px",height:"157px",top:"323px"},"data-label":"plugins"},null,-1)),t[16]||(t[16]=l("div",{class:"rect",style:{left:"468px",width:"74px",height:"33px",top:"332px"},"data-label":"shim"},null,-1)),n(i,{x1:"318",y1:"350",x2:"460",y2:"350",color:"#900000",width:"4","data-label":"arrow-fs-1"}),n(i,{x1:"506",y1:"362",x2:"506",y2:"422",color:"#900000",width:"4","data-label":"arrow-fs-2"}),t[17]||(t[17]=l("div",{class:"rect",style:{left:"431px",width:"148px",height:"99px",top:"413px"},"data-label":"filesystem-virtual"},null,-1))]),11:s(()=>[t[18]||(t[18]=l("div",{class:"host-runtime-description wasm",style:{"font-size":"80%"}},[l("p",null,[l("code",null,"plugin*.wasm"),e(" 🌐")]),l("p",null,"Même interface HTTP client via WIT."),l("p",null,[e("Implémentation basée sur "),l("code",null,"XMLHttpRequest"),e(".")]),l("p",null,[l("code",null,"jco"),e(" ne supportant pas encore les calls asynchrones.")])],-1)),n(i,{x1:"475",y1:"246",x2:"680",y2:"246",color:"#900000",width:"4","data-label":"arrow-network"}),t[19]||(t[19]=l("div",{class:"rect",style:{left:"135px",width:"341px",height:"38px",top:"224px"},"data-label":"http-client-xmlhttprequest"},null,-1)),t[20]||(t[20]=l("div",{class:"rect",style:{left:"142px",width:"152px",height:"157px",top:"323px"},"data-label":"plugins"},null,-1))]),12:s(()=>[...t[21]||(t[21]=[])]),_:1})]),_:1},16)}}};export{z as default};

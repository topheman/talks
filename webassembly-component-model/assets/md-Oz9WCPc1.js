import{_ as r}from"./slidev/VSwitch-CPC1IxvT.js";import{_ as d}from"./slidev/Arrow.vue_vue_type_script_setup_true_lang-g3RwbLj8.js";import{b as m,o as x,w as s,g as l,e as n,B as t,v as c,x as w,C as p}from"./modules/vue-DEG6N64q.js";import{I as f}from"./slidev/default-Y9OYlMuz.js";import{u as g,f as b}from"./slidev/context-fpMMTjz8.js";import"./modules/shiki-B8gquvyj.js";import"./index-BUhPof8T.js";const h="/talks/webassembly-component-model/assets/schema-cli-DT_kyC5B.png",q={__name:"slides.md__slidev_11",setup(y){const{$clicksContext:o,$frontmatter:a}=g();return o.setup(),(v,e)=>{const i=d,u=r;return x(),m(f,c(w(p(b)(p(a),10))),{default:s(()=>[e[15]||(e[15]=l("h1",null,"🏠 Host Runtime : CLI 🔧",-1)),e[16]||(e[16]=l("img",{src:h,width:"90%"},null,-1)),n(u,null,{1:s(()=>[...e[0]||(e[0]=[l("div",{class:"host-runtime-description computer"},[l("p",null,"CLI Host est lancé dans un terminal."),l("p",null,"Il fait tourner un REPL une fois lancé.")],-1),l("div",{class:"rect",style:{left:"290px",width:"140px",height:"38px",top:"130px"},"data-label":"terminal"},null,-1)])]),2:s(()=>[...e[1]||(e[1]=[l("div",{class:"host-runtime-description rust"},[l("p",null,"Le CLI est compilé depuis rust vers du natif."),l("p",null,[t("C'est le binaire "),l("code",null,"pluginlab"),t(".")])],-1),l("div",{class:"rect",style:{left:"80px",width:"185px",height:"38px",top:"165px"},"data-label":"host-cli"},null,-1)])]),3:s(()=>[...e[2]||(e[2]=[l("div",{class:"host-runtime-description rust"},[l("p",null,[l("code",null,"tokio"),t(" est utilisé pour le runtime async.")]),l("p",{style:{"font-size":"90%"}},"Il est instancié à la racine pour être partagé entre"),l("ul",null,[l("li",null,[l("code",null,"reqwest"),t(" pour le HTTP client")]),l("li",null,[l("code",null,"wasmtime"),t(" pour le runtime WebAssembly")])])],-1),l("div",{class:"rect",style:{left:"105px",width:"205px",height:"38px",top:"205px"},"data-label":"asyncruntime-tokio"},null,-1)])]),4:s(()=>[...e[3]||(e[3]=[l("div",{class:"host-runtime-description rust"},[l("p",null,[l("code",null,"wasmtime")]),l("p",null,"Instance de runtime WebAssembly."),l("p",null,"Qui est responsable de l'instanciation et l'exécution des composants WebAssembly.")],-1),l("div",{class:"rect",style:{left:"135px",width:"318px",height:"38px",top:"285px"},"data-label":"wasmtime"},null,-1)])]),5:s(()=>[...e[4]||(e[4]=[l("div",{class:"host-runtime-description rust"},[l("p",null,[l("code",null,"wasmtime")]),l("p",null,"Configuration du sandboxing filesystem."),l("p",null,[l("a",{href:"https://github.com/topheman/webassembly-component-model-experiments/blob/master/crates/pluginlab/src/engine.rs#L115",target:"_blank"},[l("code",null,"WasiCtxBuilder::preopened_dir")])]),l("p",null,"Contrôlé par les flags passés au CLI:"),l("pre",null,[l("code",null,`    --allow-read
    --allow-write
    --allow-all`)])],-1),l("div",{class:"rect",style:{left:"135px",width:"318px",height:"38px",top:"285px"},"data-label":"wasmtime"},null,-1),l("div",{class:"rect",style:{left:"471px",width:"188px",height:"70px",top:"372px"},"data-label":"wasmtime-fs-sandbox"},null,-1)])]),6:s(()=>[...e[5]||(e[5]=[l("div",{class:"host-runtime-description wasm",style:{"font-size":"70%",width:"290px"}},[l("p",null,[l("code",null,"repl-logic-guest.wasm")]),l("p",null,[l("strong",null,"Rôle:"),t(" Orchestrer l'entrée utilisateur et le dispatch de plugins")]),l("p",null,[l("strong",null,"Responsabilités:")]),l("ul",null,[l("li",null,[t("Variable expansion ("),l("code",null,"export VAR=value"),t(")")]),l("li",null,[t("Commandes réservées ("),l("code",null,"help"),t(", "),l("code",null,"man"),t(", "),l("code",null,"export"),t(")")]),l("li",null,"Dispatch de plugins")]),l("p",null,"Réutilisation du code entre CLI et navigateur (cohérence du minishell entre les plateformes).")],-1),l("div",{class:"rect",style:{left:"155px",width:"211px",height:"38px",top:"318px"},"data-label":"repl-logic"},null,-1)])]),7:s(()=>[...e[6]||(e[6]=[l("div",{class:"host-runtime-description wasm",style:{"font-size":"70%",width:"290px"}},[l("p",null,[l("code",null,"plugin*.wasm")]),l("p",null,[t("Chaque commande ("),l("code",null,"echo"),t(", "),l("code",null,"ls"),t(", "),l("code",null,"cat"),t(", "),l("code",null,"tee"),t(" ...) est un plugin.")]),l("p",null,"Chaque plugin est un composant WebAssembly."),l("p",null,"Compilé depuis Rust, C, Go, TypeScript."),l("p",null,"Tous les plugins respectent la même interface WIT.")],-1),l("div",{class:"rect",style:{left:"155px",width:"141px",height:"128px",top:"357px"},"data-label":"plugins"},null,-1)])]),8:s(()=>[e[7]||(e[7]=l("div",{class:"host-runtime-description wasm",style:{"font-size":"70%",width:"290px"}},[l("p",null,[l("code",null,"plugin*.wasm"),t(" 📁")]),l("p",null,[t("Les appels "),l("code",null,"std::fs::*"),t(" sont routés par l'instance de "),l("code",null,"wasmtime"),t(" vers le filesystem de l'hôte en respectant les contraintes de sécurité configurées au démarrage.")]),l("p",null,[l("strong",null,"#WASI")])],-1)),e[8]||(e[8]=l("div",{class:"rect",style:{left:"155px",width:"141px",height:"128px",top:"357px"},"data-label":"plugins"},null,-1)),n(i,{x1:"440",y1:"407",x2:"700",y2:"407",color:"#900000","data-label":"arrow-fs",width:"4"}),e[9]||(e[9]=l("div",{class:"rect",style:{left:"471px",width:"188px",height:"70px",top:"372px"},"data-label":"wasmtime-fs-sandbox"},null,-1))]),9:s(()=>[e[10]||(e[10]=l("div",{class:"host-runtime-description wasm",style:{"font-size":"70%",width:"290px"}},[l("p",null,[l("code",null,"plugin*.wasm"),t(" 🌐")]),l("p",null,"Une interface HTTP client est exposée via WIT."),l("p",null,"Les plugins passent par cette interface pour effectuer des requêtes HTTP."),l("p",null,[t("L'implémentation est basée sur "),l("code",null,"reqwest"),t(".")]),l("p",null,[t("C'est à ce moment qu'est fait le filtrage des permissions réseau par rapport à "),l("code",null,"--allow-net"),t(".")])],-1)),e[11]||(e[11]=l("div",{class:"rect",style:{left:"155px",width:"141px",height:"128px",top:"357px"},"data-label":"plugins"},null,-1)),e[12]||(e[12]=l("div",{class:"rect",style:{left:"135px",width:"195px",height:"38px",top:"242px"},"data-label":"http-client-reqwest"},null,-1)),e[13]||(e[13]=l("div",{class:"rect",style:{left:"471px",width:"188px",height:"70px",top:"216px"},"data-label":"network-permissions"},null,-1)),n(i,{x1:"330",y1:"260",x2:"700",y2:"260",color:"#900000","data-label":"arrow-network",width:"4"})]),10:s(()=>[...e[14]||(e[14]=[])]),_:1})]),_:1},16)}}};export{q as default};

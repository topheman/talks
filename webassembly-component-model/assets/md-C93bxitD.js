import{_ as r}from"./slidev/VSwitch-AodVSCd3.js";import{_ as d}from"./slidev/Arrow.vue_vue_type_script_setup_true_lang-2ii6LTb1.js";import{b as m,o as x,w as s,g as l,e as n,ad as e,v as c,x as w,T as p}from"./modules/vue-vE-eLd24.js";import{I as f}from"./slidev/default-CxGmgv3w.js";import{u as g,f as h}from"./slidev/context-BWOWymbD.js";import"./modules/shiki-DQqskUY8.js";import"./index-L0TOup0F.js";const b="/talks/webassembly-component-model/assets/schema-cli-DT_kyC5B.png",W={__name:"slides.md__slidev_7",setup(y){const{$clicksContext:o,$frontmatter:a}=g();return o.setup(),(v,t)=>{const i=d,u=r;return x(),m(f,c(w(p(h)(p(a),6))),{default:s(()=>[t[15]||(t[15]=l("h1",null,"🏠 Host Runtime : CLI 🔧",-1)),t[16]||(t[16]=l("img",{src:b,width:"90%"},null,-1)),n(u,null,{1:s(()=>[...t[0]||(t[0]=[l("div",{class:"host-runtime-description computer"},[l("p",null,"Le REPL tourne dans un terminal.")],-1),l("div",{class:"rect",style:{left:"290px",width:"140px",height:"38px",top:"130px"},"data-label":"terminal"},null,-1)])]),2:s(()=>[...t[1]||(t[1]=[l("div",{class:"host-runtime-description rust"},[l("p",null,"Le CLI est compilé depuis rust vers du natif."),l("p",null,[e("C'est le binaire "),l("code",null,"pluginlab"),e(".")])],-1),l("div",{class:"rect",style:{left:"80px",width:"185px",height:"38px",top:"165px"},"data-label":"host-cli"},null,-1)])]),3:s(()=>[...t[2]||(t[2]=[l("div",{class:"host-runtime-description rust"},[l("p",null,[l("code",null,"tokio"),e(" est utilisé pour le runtime async.")])],-1),l("div",{class:"rect",style:{left:"105px",width:"205px",height:"38px",top:"205px"},"data-label":"asyncruntime-tokio"},null,-1)])]),4:s(()=>[...t[3]||(t[3]=[l("div",{class:"host-runtime-description rust"},[l("p",null,[l("code",null,"wasmtime")]),l("p",null,"Runtime WebAssembly."),l("p",null,"Responsable de l'instanciation et l'exécution des composants WebAssembly.")],-1),l("div",{class:"rect",style:{left:"135px",width:"318px",height:"38px",top:"285px"},"data-label":"wasmtime"},null,-1)])]),5:s(()=>[...t[4]||(t[4]=[l("div",{class:"host-runtime-description rust"},[l("p",null,[l("code",null,"wasmtime")]),l("p",null,"Configuration du sandboxing filesystem."),l("p",null,[l("a",{href:"https://github.com/topheman/webassembly-component-model-experiments/blob/master/crates/pluginlab/src/engine.rs#L115",target:"_blank"},[l("code",null,"WasiCtxBuilder::preopened_dir")])]),l("p",null,"Contrôlé par les flags passés au CLI:"),l("pre",null,[l("code",null,`    --allow-read
    --allow-write
    --allow-all`)])],-1),l("div",{class:"rect",style:{left:"135px",width:"318px",height:"38px",top:"285px"},"data-label":"wasmtime"},null,-1),l("div",{class:"rect",style:{left:"471px",width:"188px",height:"70px",top:"372px"},"data-label":"wasmtime-fs-sandbox"},null,-1)])]),6:s(()=>[...t[5]||(t[5]=[l("div",{class:"host-runtime-description wasm",style:{"font-size":"70%",width:"290px"}},[l("p",null,[l("code",null,"repl-logic-guest.wasm")]),l("p",null,[l("strong",null,"Rôle:"),e(" Orchestre les entrées utilisateur.")]),l("p",null,[l("strong",null,"Responsabilités:")]),l("ul",null,[l("li",null,"Parsing des commandes utilisateur"),l("li",null,[e("Commandes réservées ("),l("code",null,"help"),e(", "),l("code",null,"man"),e(", "),l("code",null,"export"),e(")")])]),l("p",null,"Réutilisation du code entre CLI et navigateur (cohérence du minishell entre les plateformes).")],-1),l("div",{class:"rect",style:{left:"155px",width:"211px",height:"38px",top:"318px"},"data-label":"repl-logic"},null,-1)])]),7:s(()=>[...t[6]||(t[6]=[l("div",{class:"host-runtime-description wasm",style:{"font-size":"70%",width:"290px"}},[l("p",null,[l("code",null,"plugin*.wasm")]),l("p",null,[e("Chaque commande ("),l("code",null,"echo"),e(", "),l("code",null,"ls"),e(", "),l("code",null,"cat"),e(", "),l("code",null,"tee"),e(" ...) est un plugin.")]),l("p",null,"Chaque plugin est un composant WebAssembly."),l("p",null,"Compilé depuis Rust, C, Go, TypeScript."),l("p",null,"Tous les plugins respectent la même interface WIT.")],-1),l("div",{class:"rect",style:{left:"155px",width:"141px",height:"128px",top:"357px"},"data-label":"plugins"},null,-1)])]),8:s(()=>[t[7]||(t[7]=l("div",{class:"host-runtime-description wasm",style:{"font-size":"70%",width:"290px"}},[l("p",null,[l("code",null,"plugin*.wasm"),e(" 📁")]),l("p",null,[e("Les appels "),l("code",null,"std::fs::*"),e(" sont routés par l'instance de "),l("code",null,"wasmtime"),e(" vers le filesystem de l'hôte en respectant les contraintes de sécurité configurées au démarrage.")]),l("p",null,[l("strong",null,"#WASI")])],-1)),t[8]||(t[8]=l("div",{class:"rect",style:{left:"155px",width:"141px",height:"128px",top:"357px"},"data-label":"plugins"},null,-1)),n(i,{x1:"440",y1:"407",x2:"700",y2:"407",color:"#900000","data-label":"arrow-fs",width:"4"}),t[9]||(t[9]=l("div",{class:"rect",style:{left:"471px",width:"188px",height:"70px",top:"372px"},"data-label":"wasmtime-fs-sandbox"},null,-1))]),9:s(()=>[t[10]||(t[10]=l("div",{class:"host-runtime-description wasm",style:{"font-size":"70%",width:"290px"}},[l("p",null,[l("code",null,"plugin*.wasm"),e(" 🌐")]),l("p",null,"Une interface HTTP client est exposée via WIT."),l("p",null,"Les plugins passent par cette interface pour effectuer des requêtes HTTP."),l("p",null,[e("L'implémentation est basée sur "),l("code",null,"reqwest"),e(".")]),l("p",null,[e("C'est à ce moment qu'est fait le filtrage des permissions réseau par rapport à "),l("code",null,"--allow-net"),e(".")])],-1)),t[11]||(t[11]=l("div",{class:"rect",style:{left:"155px",width:"141px",height:"128px",top:"357px"},"data-label":"plugins"},null,-1)),t[12]||(t[12]=l("div",{class:"rect",style:{left:"135px",width:"195px",height:"38px",top:"242px"},"data-label":"http-client-reqwest"},null,-1)),t[13]||(t[13]=l("div",{class:"rect",style:{left:"471px",width:"188px",height:"70px",top:"216px"},"data-label":"network-permissions"},null,-1)),n(i,{x1:"330",y1:"260",x2:"700",y2:"260",color:"#900000","data-label":"arrow-network",width:"4"})]),10:s(()=>[...t[14]||(t[14]=[])]),_:1})]),_:1},16)}}};export{W as default};
